<!DOCTYPE html><html><head><title>Trouvauto</title><meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1"><style>body{font-size:1em;font-weight:700;width:100%;height:100%}button{background-color:#f5f5f5;display:block;font-size:1em;font-weight:700;-webkit-margin-after:.83em;-webkit-margin-before:.83em;-webkit-margin-end:0;-webkit-margin-start:0;width:100%}#footer{bottom:5px;position:fixed;right:5px}table,td,th{border:1px solid #000;border-collapse:collapse;text-align:center}</style><script type="text/javascript">function _config_(e){return{_STOP_AUTOREFRESH_AFTER_S_:300,_AUTOREFRESH_DELAY_S_:30}[e]}function _i18n_(e){return{_DATA_LOAD_TIME_:"Dernière mise-à-jour ",DISTANCE_HEADER:"Distance en mètres",EMPTY:"Vide",ERROR:"Erreur",FIND_CARS:"Recherche de véhicules Automobile...",FIND_POSITION:"Recherche de la position GPS...",GPS_ERROR:"Erreur de Géolocalisation",GPS_NOT_SUPPORTED:"Géolocalisation non supportée",REFRESH:"Rafréchir",VEHICULE_HEADER:"Véhicule"}[e]}function elmnt(e){return document.getElementById(e)}function attr(e,t,n){var o="<"+e+(n?" "+n:"")+">"+t+"</"+e+">";return o}function now(){return(new Date).getTime()}function getVehiculeHTML(e){return attr("td",e.name)+attr("td",e.distance+" m")}function getLoc(e){out(_i18n_("FIND_POSITION"),!1),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e(t)},function(e){getLoc_error(_i18n_("GPS_ERROR")+" ("+e.code+")")},{timeout:1e4}):getLoc_error(_i18n_("GPS_NOT_SUPPORTED"))}function getLoc_error(e){out(e,!0)}function openCommunauto(e){var t="https://www.reservauto.net/Scripts/Client/Mobile/ReservationDisponibility.asp?stations=false&Latitude="+e.coords.latitude+"&Longitude="+e.coords.longitude;window.open(t,"_self")}function showPosition(e){var t=stringifyPosition(e.coords);out(t,!1),out(_i18n_("FIND_CARS"),!1),httpGet(getAlkhwarizmixReservauto(e.coords.latitude,e.coords.longitude))}function stringifyPosition(e){var t="";return["latitude","longitude","accuracy","altitude","altitudeAccuracy","heading","speed","timestamp"].forEach(function(n){t+=(e[n]?e[n]:"")+"|"}),t+(new Date).getTime()}function httpGet(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.onerror=httpGet_onError,t.onreadystatechange=function(){4==t.readyState&&200==t.status&&httpGet_success(JSON.parse(t.responseText))},t.send(null)}function httpGet_onError(e){outError(e.target.status)}function httpGet_success(e){"SUCCESSFUL"===e.response.status?outVehicules(e.response.result.vehicules):outError(-20)}function getAlkhwarizmixReservauto(e,t){var n="/"+(_PROD_MODE_?"fares":"moqawalatiWeb");return n+"/alkhwarizmix/json/prototype/p/"+e+"/"+t+"/3/"}function refresh(e){e&&(autoRefreshEndTime=now()+1e3*_config_("_STOP_AUTOREFRESH_AFTER_S_")),setBtnRefreshLabel(),clearTimeout(refreshTimeout),getLoc(showPosition)}function gotoCommunauto(){clearTimeout(refreshTimeout),getLoc(openCommunauto)}function out(e,t){elmnt("result").innerHTML=e,setVisible("btnsBar",t)}function outError(e){out(_i18n_("ERROR")+": "+e,!0)}function outVehicules(e){var t=Number.MAX_VALUE,n=_i18n_("EMPTY");e.length>0&&(n=attr("tr",attr("th",_i18n_("VEHICULE_HEADER"))+attr("th",_i18n_("DISTANCE_HEADER"))),e.forEach(function(e){e.distance<t&&(t=e.distance),n+=attr("tr",getVehiculeHTML(e))}),n=attr("table",n,'border="1" style="width:100%"')),n+=attr("div",_i18n_("_DATA_LOAD_TIME_")+(new Date).toLocaleTimeString()),out(n,!0),now()<autoRefreshEndTime?(setNearestVehiculeDistance(t),setRefreshTimeout(_config_("_AUTOREFRESH_DELAY_S_"))):(setNearestVehiculeDistance(),setBtnRefreshLabel())}function setNearestVehiculeDistance(e){var t=0;if(e){var n=e-prevNearestVehiculeDistance;t=n>10?1:-10>n?2:3,prevNearestVehiculeDistance=e}document.body.style.background=["","crimson","darkseagreen","cornsilk"][t]}function setBtnRefreshLabel(e){elmnt("btnRefersh").innerHTML=_i18n_("REFRESH")+(e?e:"")}function setRefreshTimeout(e){e>0?(setBtnRefreshLabel(" (dans "+e+")"),refreshTimeout=setTimeout(function(){setRefreshTimeout(e-1)},1e3)):refresh()}function setVisible(e,t){elmnt(e).style.visibility=t===!1?"hidden":""}var _PROD_MODE_=!0,refreshTimeout=0,autoRefreshEndTime=0,prevNearestVehiculeDistance=Number.MAX_VALUE;</script></head><body onload="refresh(!0)"><div id="result"></div><div id="btnsBar"><button id="btnRefersh" onclick="refresh(!0)"></button> <button id="btnGotoCommunauto" onclick="gotoCommunauto()">Allez à Communauto</button></div><div id="footer">version: 0.0.1.10</div></body></html>